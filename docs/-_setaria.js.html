<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>_setaria.js - Documentation</title>

    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="https://code.ionicframework.com/ionicons/2.0.1/css/ionicons.min.css">
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="HTTPContext.html">HTTPContext</a></li><li><a href="Message.html">Message</a><ul class='methods'><li data-type='method'><a href="Message.html#toString">toString</a></li></ul></li><li><a href="SystemMessage.html">SystemMessage</a><ul class='methods'><li data-type='method'><a href="SystemMessage.html#toString">toString</a></li></ul></li><li><a href="ValidationMessage.html">ValidationMessage</a><ul class='methods'><li data-type='method'><a href="ValidationMessage.html#toString">toString</a></li></ul></li><li><a href="ViewModelController.html">ViewModelController</a><ul class='methods'><li data-type='method'><a href="ViewModelController.html#_execViewModelInitial">_execViewModelInitial</a></li><li data-type='method'><a href="ViewModelController.html#_execViewModelUnInitial">_execViewModelUnInitial</a></li><li data-type='method'><a href="ViewModelController.html#backTo">backTo</a></li><li data-type='method'><a href="ViewModelController.html#forwardTo">forwardTo</a></li><li data-type='method'><a href="ViewModelController.html#getTemplatePath">getTemplatePath</a></li><li data-type='method'><a href="ViewModelController.html#getViewConfigByPath">getViewConfigByPath</a></li><li data-type='method'><a href="ViewModelController.html#getViewModelConfig">getViewModelConfig</a></li><li data-type='method'><a href="ViewModelController.html#getViewPathFromHash">getViewPathFromHash</a></li><li data-type='method'><a href="ViewModelController.html#loadScript">loadScript</a></li></ul></li></ul><h3>Namespaces</h3><ul><li><a href="-_action.html">_action</a><ul class='methods'><li data-type='method'><a href="-_action.html#doAction">doAction</a></li></ul></li><li><a href="-_config.html">_config</a><ul class='methods'><li data-type='method'><a href="-_config.html#createCacheToken">createCacheToken</a></li><li data-type='method'><a href="-_config.html#getMobileOperatingSystem">getMobileOperatingSystem</a></li></ul></li><li><a href="-_cookie.html">_cookie</a><ul class='methods'><li data-type='method'><a href="-_cookie.html#getItem">getItem</a></li><li data-type='method'><a href="-_cookie.html#hasItem">hasItem</a></li><li data-type='method'><a href="-_cookie.html#removeItem">removeItem</a></li><li data-type='method'><a href="-_cookie.html#setItem">setItem</a></li></ul></li><li><a href="-_globalParam.html">_globalParam</a><ul class='methods'><li data-type='method'><a href="-_globalParam.html#clear">clear</a></li><li data-type='method'><a href="-_globalParam.html#get">get</a></li><li data-type='method'><a href="-_globalParam.html#set">set</a></li></ul></li><li><a href="-_handler.html">_handler</a><ul class='methods'><li data-type='method'><a href="-_handler.html#doCatch">doCatch</a></li><li data-type='method'><a href="-_handler.html#doFinally">doFinally</a></li><li data-type='method'><a href="-_handler.html#doPreProcess">doPreProcess</a></li></ul></li><li><a href="-_html.html">_html</a><ul class='methods'><li data-type='method'><a href="-_html.html#bindEventById">bindEventById</a></li><li data-type='method'><a href="-_html.html#bindEventByName">bindEventByName</a></li><li data-type='method'><a href="-_html.html#byId">byId</a></li><li data-type='method'><a href="-_html.html#disable">disable</a></li><li data-type='method'><a href="-_html.html#enable">enable</a></li><li data-type='method'><a href="-_html.html#getFormItemValueByName">getFormItemValueByName</a></li><li data-type='method'><a href="-_html.html#getValue">getValue</a></li><li data-type='method'><a href="-_html.html#hide">hide</a></li><li data-type='method'><a href="-_html.html#removeDomNode">removeDomNode</a></li><li data-type='method'><a href="-_html.html#removeDomNodeById">removeDomNodeById</a></li><li data-type='method'><a href="-_html.html#setFormItemValueByName">setFormItemValueByName</a></li><li data-type='method'><a href="-_html.html#setValue">setValue</a></li><li data-type='method'><a href="-_html.html#show">show</a></li><li data-type='method'><a href="-_html.html#unBindEventById">unBindEventById</a></li><li data-type='method'><a href="-_html.html#validate">validate</a></li></ul></li><li><a href="-_http.html">_http</a><ul class='methods'><li data-type='method'><a href="-_http.html#doAsync">doAsync</a></li><li data-type='method'><a href="-_http.html#doSync">doSync</a></li></ul></li><li><a href="-_log.html">_log</a><ul class='methods'><li data-type='method'><a href="-_log.html#debug">debug</a></li><li data-type='method'><a href="-_log.html#error">error</a></li></ul></li><li><a href="-_message.html">_message</a><ul class='methods'><li data-type='method'><a href="-_message.html#getMessage">getMessage</a></li><li data-type='method'><a href="-_message.html#getSystemMessage">getSystemMessage</a></li></ul></li><li><a href="-_ui.html">_ui</a><ul class='methods'><li data-type='method'><a href="-_ui.html#_showErrorMessage">_showErrorMessage</a></li><li data-type='method'><a href="-_ui.html#backTo">backTo</a></li><li data-type='method'><a href="-_ui.html#forwardTo">forwardTo</a></li><li data-type='method'><a href="-_ui.html#showDialog">showDialog</a></li><li data-type='method'><a href="-_ui.html#showErrorMessage">showErrorMessage</a></li><li data-type='method'><a href="-_ui.html#showMessage">showMessage</a></li><li data-type='method'><a href="-_ui.html#showModalDialog">showModalDialog</a></li><li data-type='method'><a href="-_ui.html#toggleProcessing">toggleProcessing</a></li><li data-type='method'><a href="-_ui.html#updateDocumentTitle">updateDocumentTitle</a></li><li data-type='method'><a href="-_ui.html#updateHTML">updateHTML</a></li></ul></li><li><a href="-_url.html">_url</a><ul class='methods'><li data-type='method'><a href="-_url.html#clearHash">clearHash</a></li><li data-type='method'><a href="-_url.html#clearUrlParameter">clearUrlParameter</a></li><li data-type='method'><a href="-_url.html#getCurrentUrl">getCurrentUrl</a></li><li data-type='method'><a href="-_url.html#getHashParams">getHashParams</a></li><li data-type='method'><a href="-_url.html#getUrlParameter">getUrlParameter</a></li><li data-type='method'><a href="-_url.html#redirectTo">redirectTo</a></li><li data-type='method'><a href="-_url.html#redirectToErrorPage">redirectToErrorPage</a></li><li data-type='method'><a href="-_url.html#setUrlParameter">setUrlParameter</a></li></ul></li><li><a href="-_util.html">_util</a><ul class='methods'><li data-type='method'><a href="-_util.html#dateFormat">dateFormat</a></li><li data-type='method'><a href="-_util.html#escape">escape</a></li><li data-type='method'><a href="-_util.html#get">get</a></li><li data-type='method'><a href="-_util.html#getFileContent">getFileContent</a></li><li data-type='method'><a href="-_util.html#has">has</a></li><li data-type='method'><a href="-_util.html#isArguments">isArguments</a></li><li data-type='method'><a href="-_util.html#isArray">isArray</a></li><li data-type='method'><a href="-_util.html#isBoolean">isBoolean</a></li><li data-type='method'><a href="-_util.html#isEmpty">isEmpty</a></li><li data-type='method'><a href="-_util.html#isFunction">isFunction</a></li><li data-type='method'><a href="-_util.html#isNumber">isNumber</a></li><li data-type='method'><a href="-_util.html#isObject">isObject</a></li><li data-type='method'><a href="-_util.html#isString">isString</a></li><li data-type='method'><a href="-_util.html#keys">keys</a></li><li data-type='method'><a href="-_util.html#parseDate">parseDate</a></li></ul></li></ul><h3>Global</h3><ul><li><a href="global.html#_setaria">_setaria</a></li></ul>
</nav>

<div id="main">
    
    <h1 class="page-title">_setaria.js</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * 系统处理模块
 *
 * @version 1.0
 * @author HanL
 */
 var _setaria = new function(){
    "use strict";

    /**
     * 取得Setaria配置信息
     *
     * @private
     *
     * @return {Boolean} 配置信息取得成功的场合，返回true
     */
    function _loadConfig(){
        var ret = false;
        $("script").each(function(){
            // 配置文件路径
            var dataConfig = $(this).attr("data-setaria-config");
            // 配置文件内容
            var configContent = null;

            if (!_util.isEmpty(dataConfig)){
                // 取得配置文件内容
                configContent = _util.getFileContent(dataConfig, "json");

                // 无法取得配置文件的场合
                if (_util.isEmpty(configContent) ||
                        (!_util.isEmpty(configContent.textStatus) &amp;&amp;
                            configContent.textStatus === "error")){
                    _ui.showMessage("无法读取客户端系统配置文件。", "error");
                }else{
                    // 复制配置信息
                    $.each(configContent, function(key, value){
                        _config[key] = value;
                    });
                    ret = true;
                }
                // 退出循环
                return false;
            }
        });
        return ret;
    }

    /**
     * 取得当前路径
     *
     * @private
     * @return {string}
     */
    function _getContextRoot(){
        var ret = window.location.pathname;
        var pathLength = null;
        var pathArr = null;
        // 取得配置文件绝对路径
        if (ret !== "/"){
            ret = ret.substring(1);
            pathArr = ret.split("/");
            if (pathArr.length > 1){
                // 路径最后为文件的场合
                if (pathArr[pathArr.length - 1].indexOf(".")){
                    // 删除最后
                    pathArr.pop();
                }
            }
            ret = "/";
            for (var i = 0; i &lt; pathArr.length; i++){
                ret += pathArr[i] + "/";
            }
        }
        return ret;
    }

    /**
     * 启动函数
     *
     * @param {Function} hanlder
     * @public
     */
    this.start = function(handler){
        // 取得资源根目录
        var shellRoot = _util.isEmpty(_config.SHELL_ROOT) ? _getContextRoot() : _config.SHELL_ROOT;
        _config.SHELL_ROOT = shellRoot;
        // 取得配置信息
        var loadConfigResult = _loadConfig();
        // 当成功加载配置文件时
        if (loadConfigResult){
            // 更新引用文件的缓存
            // this.appendTokenOnImportFile();
            // 加载viewModel
            // 默认ViewModel的配置文件
            var defaultViewModelConfigFile = _config.VIEWMODEL_CONFIG_FILE;
            // 初期化ViewModelController
            window._viewModelController = new ViewModelController(defaultViewModelConfigFile);
            // 绑定Hash Change事件
            this.bindHashChange();
            if (_util.isFunction(handler)){
                handler();
            }
            // 跳转页面
            this.dispatcher(window._viewModelController);
        }
    };

    /**
     * 绑定window的hashchange事件
     *
     * @public
     */
    this.bindHashChange = function(){
        $(window).on("hashchange", this.doHashChange);
    };

    /**
     * window的hashchange事件处理
     *
     * @public
     */
    this.doHashChange = function(){
        // TODO 点击了浏览器的回退按钮的场合，如何进行判断，是否引入history?
    };

    /**
     * Customize Dispatcher
     *
     * @public
     * @param  {ViewModelController} vmController 当前VMController实例
     */
    var dispatcher = function(vmController){
        this.defaultDispatcher(vmController);
    };
    this.dispatcher = dispatcher;

    /**
     * 默认跳转逻辑
     *
     * @public
     * @param  {ViewModelController} vmController 当前VMController实例
     */
    this.defaultDispatcher = function(vmController){
        // 当前的Hash值
        var hash = window.location.hash;
        // ViewModel的映射路径
        var path = null;
        // ViewModel的参数
        var param = null;
        // 目标跳转画面的信息
        var viewModelParams = [];

        // 如果存在页面跳转定义
        if (!_util.isEmpty(hash) &amp;&amp; hash !== "#"){
            // 根据Hash值取得已配置的View的Url映射路径
            path = vmController.getViewPathFromHash(hash);
            // 没有找到对应的View
            if (_util.isEmpty(path)){
                // 跳转至首页
                _ui.forwardTo(_config.WELCOME_PAGE);
            }else{
                // 组装目标跳转画面的信息
                viewModelParams[0] = path;
                // 取得path后的字符作为参数传给ViewModel
                param = hash.substring(hash.indexOf(path) + path.length);
                viewModelParams[1] = param;
                // 画面跳转
                _ui.forwardTo.apply(_ui, viewModelParams);
            }
        }else{
            // 跳转至首页
            _ui.forwardTo(_config.WELCOME_PAGE);
        }
    };
 };
</code></pre>
        </article>
    </section>




</div>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.4.3</a> on Fri Nov 25 2016 18:33:55 GMT+0800 (CST) using the Minami theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/linenumber.js"></script>
</body>
</html>
