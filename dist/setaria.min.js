/**
 * Setaria v0.0.4
 * (c) 2017 Ray Han
 * @license MIT
 */
!function(t,n){"object"==typeof exports&&"undefined"!=typeof module?module.exports=n(require("vue"),require("lodash"),require("moment"),require("moment/locale/zh-cn"),require("axios"),require("vue-router"),require("vuex")):"function"==typeof define&&define.amd?define(["vue","lodash","moment","moment/locale/zh-cn","axios","vue-router","vuex"],n):t.Setaria=n(t.Vue$1,t._,t.moment,null,t.axios,t.VueRouter,t.Vuex)}(this,function(t,n,r,e,o,i,u){"use strict";function c(t){Vue||(Vue=t,g(Vue))}function a(){var t={},n=y.message;return v.isEmpty(n)||v.isString(n)||v.isObject(n)&&(t=n),t}function s(){return Object.assign({},w,a())}function f(t){return s()[t]}function d(t,n){void 0===t&&(t="");var r=v.isEmpty(f(t))?"":f(t);return v.isEmpty(r)||v.isEmpty(n)||n.forEach(function(t,e){r=r.split("{"+e+"}").join(n[e])}),r}function l(t){void 0===t&&(t=null);var n="";switch(null!==t?t.charAt(t.length-1):""){case"E":n="error";break;case"W":n="warning";break;case"I":n="info";break;default:n="error"}return n}function p(t){var n=!1;return v.isObject(t)&&!v.isEmpty(t.id)?n=!0:v.isString(t)&&(n=-1!==t.indexOf(b)),n}function m(t){var n=t;v.isObject(t)&&(n=t.message),n=n.replace("Uncaught Error: ","");var r=n.split(I),e=r[0].replace(b,"").replace("[","").replace("]",""),o=r[1];return new A(e,null,o)}function h(t,n,r,e){void 0===e&&(e={});var i=null,u=e;return t===D.GET?(u.params=r,i=o[D.GET](n,u)):i=o[t](n,r,u),new Promise(function(t,n){i.then(function(n){t(n)}).catch(function(t){var r=t;if(0===t.message.indexOf("timeout of")){r=new A("MAM003E",[1e3])}else t.response&&t.response.status>=500&&(r=new A("MAM001E"));n(r)})})}function E(t){E.installed||(E.installed=!0,i.install(t),t.mixin({destroyed:function(){this.$store.commit("common/direction","")}}))}t="default"in t?t.default:t,n="default"in n?n.default:n,r="default"in r?r.default:r,o="default"in o?o.default:o,i="default"in i?i.default:i,u="default"in u?u.default:u;var y={message:"",errorHanlder:null,router:{}},g=function(){};"undefined"!=typeof window&&window.Vue&&c(window.Vue);var v=function(){};v.isProdunctionEnv=function(){return!0},v.getNow=function(t){return void 0===t&&(t="LL"),r().format(t)},v.formatDate=function(t,n){void 0===n&&(n="YYYY-MM-DD");var e="";return r(t).isValid()&&void 0!==t&&(e=r(t).format(n)),e},v.toDate=function(t){var n=t;return v.isEmpty(t)||(n=r(t).toDate()),n},v.addDateTime=function(t,n,e){return r(t).add(n,e)},v.subtractDateTime=function(t,n,e){return r(t).subtract(n,e)},v.isEmpty=function(t){return n.isEmpty(t)},v.isEqual=function(t,r){return n.isEqual(t,r)},v.isNumber=function(t){return n.isNumber(t)},v.isString=function(t){return n.isString(t)},v.isDate=function(t){return n.isDate(t)},v.isArray=function(t){return n.isArray(t)},v.isObject=function(t){return n.isObject(t)},v.isFunction=function(t){return n.isFunction(t)},v.get=function(t,r,e){return void 0===e&&(e=null),n.get(t,r,e)},v.cloneDeep=function(t){return n.cloneDeep(t)},v.getUrlParameter=function(t){var n=window.location.search.substring(1),r=n.split("&"),e=r.find(function(n){return n.split("=")[0]===t});return e&&(e=e.split("=")[1]),e};var w={MAM001E:"\u670d\u52a1\u8c03\u7528\u51fa\u73b0\u7f51\u7edc\u9519\u8bef\uff0c\u65e0\u6cd5\u8c03\u7528\u6307\u5b9a\u670d\u52a1\uff0c\u8bf7\u68c0\u67e5\u7f51\u7edc\u3002",MAM002E:"\u7531\u4e8e\u60a8\u957f\u65f6\u95f4\u672a\u64cd\u4f5c\uff0c\u767b\u5f55\u72b6\u6001\u5df2\u8fc7\u671f\uff0c\u8bf7\u91cd\u65b0\u767b\u5f55\u3002",MAM003E:"\u670d\u52a1\u672a\u5728\u9884\u5b9a\u65f6\u95f4\uff08{0}\u79d2\uff09\u5185\u8fd4\u56de\u7ed3\u679c\uff0c\u8bf7\u8054\u7cfb\u7ba1\u7406\u5458\u6216\u7a0d\u540e\u91cd\u8bd5\u3002",MAM004E:"\u5ba2\u6237\u7aef\u51fa\u73b0\u9519\u8bef\uff0c\u8bf7\u91cd\u8bd5\u6216\u8054\u7cfb\u7ba1\u7406\u5458\u3002",MAM005E:"\u8ba4\u8bc1\u8fc7\u671f\u6216\u65e0\u6743\u8bbf\u95ee\u6b64\u670d\u52a1\uff0c\u8bf7\u70b9\u51fb\u6ce8\u9500\u6309\u94ae\u91cd\u65b0\u767b\u5f55\u3002",MAM006E:"\u65e0\u6cd5\u627e\u5230\u6307\u5b9a\u7684\u753b\u9762\u3002",MAM007E:"\u670d\u52a1\u8c03\u7528\u51fa\u73b0\u672a\u77e5\u9519\u8bef\uff0c\u8bf7\u91cd\u8bd5\u6216\u8054\u7cfb\u7ba1\u7406\u5458\u3002",MAM008E:"\u65e0\u6cd5\u627e\u5230\u6307\u5b9a\u7684{0}\u5b9a\u4e49\u6587\u4ef6\u3002"},x={SUCCESS:"success",WARNING:"warning",INFO:"info",ERROR:"error"},M=function(t,n,r){this.id=t,this.type=l(t),this.params=n,this.message=d(this.id,this.params),v.isEmpty(this.message)&&!v.isEmpty(r)&&(this.message=r)};M.prototype.getMessage=function(){return this.message},M.prototype.toString=function(){return this.message};var b="Setaria Error",I=":",A=function(t){function n(n,r,e){var o=e;v.isEmpty(e)&&(o=new M(n,r,e).getMessage(),o=b+"["+n+"]"+I+o),t.call(this,o),this.id=n,this.params=r,this.type=x.ERROR,this.message=o}return t&&(n.__proto__=t),n.prototype=Object.create(t&&t.prototype),n.prototype.constructor=n,n}(Error),O=function(){};O.catchError=function(){t.config.errorHandler=function(t,n){O.handleError(t,n)},window.onerror=function(t){O.handleError(t)},window.onunhandledrejection=function(t){O.handleError(t)}},O.handleError=function(t,n){var r=O.parseError(t,n);v.isFunction(y.errorHanlder)&&y.errorHanlder(r,t)},O.parseError=function(t,n){var r=null,e=n instanceof Object;return p(t)?r=m(t):v.isEmpty(t.reason)?t instanceof Error?r=v.isProdunctionEnv()?new A("MAM004E"):t:e?r=v.isProdunctionEnv()?new A("MAM004E"):t:v.isString(t)&&(0===t.indexOf("Uncaught Error: ")&&(r=t.replace("Uncaught Error: ","")),r=new A(null,null,r)):r=t.reason,(null===r||void 0===r||!v.isEmpty(r)&&v.isEmpty(r.message))&&(r=new A("MAM004E")),r};var D={GET:"get",POST:"post",PUT:"put",DELETE:"delete"},T=function(){};T.get=function(t,n,r){return h(D.GET,t,n,r)},T.post=function(t,n,r){return h(D.POST,t,n,r)},T.put=function(t,n,r){return h(D.PUT,t,n,r)},T.delete=function(t,n,r){return h(D.DELETE,t,n,r)};var k,P={direction:"",loading:!1,routeHistory:{currentIndex:null,history:[]},token:"",user:null},S={routeHistory:function(t){return t.routeHistory},routeCurrentIndex:function(t){return t.routeHistory.currentIndex}},H={},j={direction:function(t,n){t.direction=n},loading:function(t,n){t.loading=n},token:function(t,n){t.token=n},user:function(t,n){t.user=n},updateDirection:function(t,n){var r=(n.current,n.next),e=t.direction;console.log("updateDirection",e);var o=t.routeHistory;if("forward"!==e&&"back"!==e){if(o.history.length>0)if(o.currentIndex===o.history.length-1)e="back";else{0!==o.currentIndex&&o.history[o.currentIndex]===r&&(e="back"),""===e&&o.history[o.currentIndex+1]===r&&(e="forward")}else e="forward";"forward"!==e&&"back"!==e&&(e="forward"),t.direction=e}console.log(t.direction)},updateHistory:function(t,n){var r=n.current,e=n.next,o=t.direction,i=t.routeHistory;if("back"===o)0===i.currentIndex?i.currentIndex=null:(i.history[i.currentIndex]=r,i.currentIndex-=1);else if("forward"===o){if(null===i.currentIndex)i.currentIndex=0;else{if(i.currentIndex<i.history.length-1){var u=i.history.splice(0,i.currentIndex+1);i.history=u}i.currentIndex+=1}i.history.push(e)}}},V={namespaced:!0,state:P,getters:S,actions:H,mutations:j},q={modules:{common:V},strict:!1};t.use(u);var _=function(t){return k=new t(q)}(u.Store),R=function(t,n,r){var e=t.params,o=n.fullPath,i=_.state.common.direction,u=t.fullPath;e&&"forward"===e.$$direction&&(i="forward",_.commit("common/direction",i)),_.commit("common/updateDirection",{current:o,next:u}),r()},N=function(t,n,r){var e=n.fullPath,o=t.fullPath;_.commit("common/updateHistory",{current:e,next:o}),r()},U=function(t){function n(n){void 0===n&&(n={}),t.call(this,n),this.beforeEach(R),this.beforeEach(N)}return t&&(n.__proto__=t),n.prototype=Object.create(t&&t.prototype),n.prototype.constructor=n,n.prototype.forwardTo=function(t,n,r){void 0===n&&(n={}),void 0===r&&(r={}),_.commit("common/direction","forward"),this.push({name:t,params:n,query:r})},n.prototype.push=function(n,r,e){_.commit("common/direction","forward"),t.prototype.push.call(this,n,r,e)},n.prototype.forward=function(){_.commit("common/direction","forward"),t.prototype.forward.call(this)},n.prototype.backTo=function(){_.commit("common/direction","back"),t.prototype.back.call(this)},n}(i);return U.install=E,"undefined"!=typeof window&&window.Vue&&window.Vue.use(U),v.isProdunctionEnv()&&(t.config.silent=!0,t.config.productionTip=!1),O.catchError(),{install:c,config:y,plugin:{Navigate:U,store:_},version:"0.0.4",ApplicationError:A,Http:T,Message:M,util:v}});