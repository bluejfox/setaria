/**
 * Setaria v0.2.0
 * (c) 2018 Ray Han
 * @license MIT
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(require("vue"),require("lodash"),require("moment"),require("moment/locale/zh-cn"),require("axios"),require("vue-router"),require("vuex")):"function"==typeof define&&define.amd?define(["vue","lodash","moment","moment/locale/zh-cn","axios","vue-router","vuex"],e):t.Setaria=e(t.Vue,t._,t.moment,null,t.axios,t.VueRouter,t.Vuex)}(this,function(t,e,r,n,i,o,a){"use strict";function u(t){}function s(){return k.message?k.message:{}}function c(){return Object.assign({},L,s())}function f(t){return c()[t]}function d(t,e){void 0===t&&(t=""),void 0===e&&(e=[]);var r=f(t),n=null===r||void 0===r?"":r;return R.isEmpty(n)||R.isEmpty(e)||e.forEach(function(t,e){var r="{"+e+"}";if(-1!==n.indexOf(r)){var i="number"==typeof t?t.toString():t;n=n.split(r).join(i)}}),n}function l(t){var e="";switch(t.charAt(t.length-1)){case"E":e="error";break;case"W":e="warning";break;case"I":default:e="info"}return e}function _(t){var e=document.createEvent("Event");e.initEvent("unhandledrejection",!1,!0);var r={reason:{value:t,writable:!1}};Object.defineProperties(e,r),window.dispatchEvent(e)}function p(t){var e=!1;return t instanceof Object&&null!==t&&void 0!==t&&null!==t.id&&void 0!==t.id?e=!0:"string"==typeof t&&(e=-1!==t.indexOf(H)),e}function E(t){var e="",r="";if("string"==typeof t){0===t.indexOf("Error: ")?t=t.replace("Error: ",""):0===t.indexOf("Uncaught Error: ")&&(t=t.replace("Uncaught Error: ",""));var n=t.split(Y);return e=n[0].replace(H,"").replace("[","").replace("]",""),r=n[1],new F(e,[],r)}return new F(t.id,[],t.noIdMessage)}function m(){return Q}function v(t,e){var r=new $("MAM001E",e);if(null!==t&&void 0!==t){var n=null;switch(t){case 404:n="404";break;default:n="001"}r=new $("MAM"+n+"E",e)}return r}function h(t,e,r,n){return void 0===n&&(n={}),new Promise(function(o,a){var u=null,s=n;t===et.GET||t===et.DELETE||t===et.OPTIONS?(s.params=r,u=i[t](e,s)):u=i[t](e,r,s);var c=m();!1!==n.loading&&null!==c&&void 0!==c&&c.commit(B.ADD_LOADING_COUNT),u.then(function(t){!1!==n.loading&&null!==c&&void 0!==c&&c.commit(B.SUB_LOADING_COUNT),o(t)}).catch(function(t){!1!==n.loading&&null!==c&&void 0!==c&&c.commit(B.SUB_LOADING_COUNT);var e=new $("MAM001E",t);if(null!==t.response&&void 0!==t.response&&"number"==typeof t.response.status&&(e=v(t.response.status,t)),0===t.message.indexOf("timeout of")){var r=t.config.timeout;e=void 0===r||null===r?new $("MAM007E",t):new $("MAM003E",t,[r])}a(e)})})}function g(t){return new Promise(function(e,r){i.all(t).then(function(t){e(t)})})}function y(t){return t===it.LOCAL?window.localStorage:window.sessionStorage}function O(t,e){y(t).setItem(nt,JSON.stringify(e))}function I(t){var e=y(t);return null===e.getItem(nt)&&e.setItem(nt,JSON.stringify({})),JSON.parse(e.getItem(nt))}function T(t,e,r){var n=I(t);n[e]=r,O(t,n)}function w(t,e){return I(t)[e]}function S(t,e){var r=I(t);delete r[e],O(t,r)}function b(t){O(t,{})}function A(t){A.installed||(A.installed=!0,o.install(t),t.mixin({mounted:function(){this.$store&&this.$store.commit(B.SET_DIRECTION,"")}}))}function N(t){var e=null;try{e=require("../../../src/middleware/"+t+".js"),e&&(e=e.default)}catch(e){console.debug("\u627e\u4e0d\u5230\u6307\u5b9a\u7684\u4e2d\u95f4\u4ef6"+t,e)}return e}function x(t,e){null!==e&&void 0!==e?t(e):t()}function M(t){var e=[];return t.forEach(function(t){R.isEmpty(t.middleware)?R.isEmpty(t.children)||(e=e.concat(M(t.children))):e.push(t)}),e}function D(t,e){var r=t.name,n=t.matched,i=e.name,o=e.path;if(!R.isEmpty(i))return r===i;if(!R.isEmpty(n)&&!R.isEmpty(o)){var a=n[n.length-1].path;if(0!==o.indexOf("/")&&(n.forEach(function(t){0===a.indexOf(t.path)&&(a=a.substring(t.path.length))}),n.length>1&&0===a.indexOf("/")&&(a=a.substring(1))),a===o)return!0}return!1}t="default"in t?t.default:t,e="default"in e?e.default:e,r="default"in r?r.default:r,i="default"in i?i.default:i,o="default"in o?o.default:o,a="default"in a?a.default:a;var L={MAM001E:"\u8c03\u7528\u8fdc\u7a0b\u670d\u52a1\u7684\u8fc7\u7a0b\u4e2d\u51fa\u73b0\u672a\u77e5\u9519\u8bef\uff0c\u8bf7\u91cd\u8bd5\u6216\u8054\u7cfb\u7ba1\u7406\u5458\u3002",MAM002E:"\u7531\u4e8e\u60a8\u957f\u65f6\u95f4\u672a\u64cd\u4f5c\uff0c\u767b\u5f55\u72b6\u6001\u5df2\u8fc7\u671f\uff0c\u8bf7\u91cd\u65b0\u767b\u5f55\u3002",MAM003E:"\u670d\u52a1\u672a\u5728\u9884\u5b9a\u65f6\u95f4\uff08{0}\u79d2\uff09\u5185\u8fd4\u56de\u7ed3\u679c\uff0c\u8bf7\u8054\u7cfb\u7ba1\u7406\u5458\u6216\u7a0d\u540e\u91cd\u8bd5\u3002",MAM004E:"\u5ba2\u6237\u7aef\u51fa\u73b0\u9519\u8bef\uff0c\u8bf7\u91cd\u8bd5\u6216\u8054\u7cfb\u7ba1\u7406\u5458\u3002",MAM005E:"\u8ba4\u8bc1\u8fc7\u671f\u6216\u65e0\u6743\u8bbf\u95ee\u6b64\u670d\u52a1\uff0c\u8bf7\u70b9\u51fb\u6ce8\u9500\u6309\u94ae\u91cd\u65b0\u767b\u5f55\u3002",MAM006E:"\u65e0\u6cd5\u627e\u5230\u6307\u5b9a\u7684\u753b\u9762\u3002",MAM007E:"\u8bf7\u6c42\u7684\u670d\u52a1\u8bbf\u95ee\u8d85\u65f6\uff0c\u8bf7\u8054\u7cfb\u7ba1\u7406\u5458\u6216\u7a0d\u540e\u91cd\u8bd5\u3002",MAM008E:"\u65e0\u6cd5\u627e\u5230\u6307\u5b9a\u7684{0}\u5b9a\u4e49\u6587\u4ef6\u3002",MAM404E:"\u8bf7\u6c42\u7684\u670d\u52a1\u4e0d\u5b58\u5728\u3002"},R=function(){};R.isProdunctionEnv=function(){return!0},R.isFirefox=function(){var t=window.navigator.userAgent.toLowerCase();return"undefined"!=typeof window&&t&&/firefox\/\d+/.test(t)},R.getNow=function(t){return void 0===t&&(t="LL"),r().format(t)},R.formatDate=function(t,e){void 0===e&&(e="YYYY-MM-DD");var n="";return r(t).isValid()&&void 0!==t&&(n=r(t).format(e)),n},R.toDate=function(t){var e=t;return R.isEmpty(t)||(e=r(t).toDate()),e},R.addDateTime=function(t,e,n){return r(t).add(e,n)},R.subtractDateTime=function(t,e,n){return r(t).subtract(e,n)},R.isEmpty=function(t){return e.isEmpty(t)},R.isEqual=function(t,r){return e.isEqual(t,r)},R.isNumber=function(t){return e.isNumber(t)},R.isString=function(t){return e.isString(t)},R.isDate=function(t){return e.isDate(t)},R.isArray=function(t){return e.isArray(t)},R.isObject=function(t){return e.isObject(t)},R.isFunction=function(t){return e.isFunction(t)},R.get=function(t,r,n){return void 0===n&&(n=null),e.get(t,r,n)},R.cloneDeep=function(t){return e.cloneDeep(t)},R.getUrlParameter=function(t){var e=window.location.search.substring(1),r=e.split("&"),n=r.find(function(e){return e.split("=")[0]===t});return n=null===n||void 0===n?"":n.split("=")[1]};var C={$env:{},env:{dev:{},prod:{}},message:{},router:{routes:[]}};try{var U=require("../../../setaria.config.js");void 0!==U&&null!==U&&(C=U.default),C.message=Object.assign({},L,U.message)}catch(t){console.error("setaria.config.js\u6587\u4ef6\u4e0d\u5b58\u5728")}var P=R.get(C,"env.dev",{}),j=R.get(C,"env.prod",{});R.isEmpty(P)&&R.isEmpty(j)&&!R.isEmpty(C.env)&&(j=C.env),C.$env=C.env,R.isProdunctionEnv()?C.env=Object.assign({},j):C.env=Object.assign({},j,P);var k=C,G={SUCCESS:"success",WARNING:"warning",INFO:"info",ERROR:"error"},q=function(t,e,r){void 0===t&&(t=""),void 0===e&&(e=[]),void 0===r&&(r=""),this.id=t,this.type=l(t),this.params=e,this.message=d(this.id,this.params),R.isEmpty(this.message)&&!R.isEmpty(r)&&(this.message=r)};q.prototype.getMessage=function(){return this.message},q.prototype.toString=function(){return this.message};var H="Setaria Error",Y=":",F=function(t){function e(e,r,n){void 0===e&&(e=""),void 0===r&&(r=[]),void 0===n&&(n="");var i=n;R.isEmpty(e)&&(e="unknown"),R.isEmpty(n)&&(i=new q(e,r,n).getMessage());var o=H+"["+e+"]"+Y+i;t.call(this,o),this.id=e,this.params=r,this.type=G.ERROR,this.noIdMessage=i,this.message=o}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(Error),$=function(t){function e(e,r,n,i){void 0===e&&(e=""),void 0===r&&(r={}),void 0===n&&(n=[]),void 0===i&&(i=""),t.call(this,e,n,i),this.type="ServiceError",this.detail=r,R.isFirefox()&&!1!==R.get(r,"config.isShowError",!0)&&_(this)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(F),V=function(){};V.catchError=function(){t.config.errorHandler=function(t,e){V.handleError(t,e)},window.onerror=function(t){V.handleError(t)},window.addEventListener("unhandledrejection",function(t){V.handleError(t)})},V.handleError=function(t,e){var r=this.parseError(t,e);"function"==typeof k.errorHanlder&&k.errorHanlder(r,t)},V.parseError=function(t,e){var r=null,n=e instanceof Object;if(p(t))r=E(t);else if("unhandledrejection"===t.type&&"object"==typeof t){var i=t.reason,o=i.id,a=i.message,u=i.noIdMessage,s=i.detail;r="ServiceError"===t.reason.type?t.reason:null!==u&&void 0!==u?new $(o,s,[],u):null!==a&&void 0!==a?new $("",s,[],a):new $("MAM004E",s)}else if(n&&t instanceof Error)if(R.isProdunctionEnv())r=new F("MAM004E");else{var c=t.message;r=new F("",[],c)}else r="string"==typeof t?0===t.indexOf("Uncaught Error: ")?new F("",[],t.replace("Uncaught Error: ","")):new F("",[],t):new F("MAM004E");return n&&console.error(t),r};var B={GET_IS_LOADING:"_setaria_get_is_loading",GET_LOADING_COUNT:"_setaria_get_loading_count",GET_ROUTE_HISTORY:"_setaria_get_route_history",GET_ROUTE_CURRENT_INDEX:"_setaria_get_route_current_index",GET_USER:"_setaria_get_user",GET_TOKEN:"_setaria_get_token",GET_DIRECTION:"_setaria_get_direction",SET_DIRECTION:"_setaria_set_direction",ADD_LOADING_COUNT:"_setaria_add_loading_count",SUB_LOADING_COUNT:"_setaria_sub_loading_count",SET_TOKEN:"_setaria_set_token",SET_USER:"_setaria_set_user",UPDATE_DIRECTION:"_setaria_update_direction",UPDATE_ROUTE_HISTORY:"_setaria_update_route_history"},J={_setaria_direction:"",_setaria_loading:0,_setaria_routeHistory:{currentIndex:null,history:[]},_setaria_token:"",_setaria_user:null},z={};z._setaria_get_route_history=function(t){return t._setaria_routeHistory},z._setaria_get_route_current_index=function(t){return t._setaria_routeHistory.currentIndex},z._setaria_get_is_loading=function(t){return 0!==t._setaria_loading},z._setaria_get_loading_count=function(t){return t._setaria_loading},z._setaria_get_user=function(t){return t._setaria_user},z._setaria_get_token=function(t){return t._setaria_token},z._setaria_get_direction=function(t){return t._setaria_direction};var K={},W={};W._setaria_set_direction=function(t,e){t._setaria_direction=e},W._setaria_add_loading_count=function(t){t._setaria_loading+=1},W._setaria_sub_loading_count=function(t){var e=t;e._setaria_loading>0&&(e._setaria_loading-=1)},W._setaria_set_token=function(t,e){t._setaria_token=e},W._setaria_set_user=function(t,e){t._setaria_user=e},W._setaria_update_direction=function(t,e){var r=(e.current,e.next),n=t._setaria_direction,i=t._setaria_routeHistory;if("forward"!==n&&"back"!==n){if(i.history.length>0)if(i.currentIndex===i.history.length-1)n="back";else{0!==i.currentIndex&&i.history[i.currentIndex-1]===r&&(n="back"),""===n&&i.history[i.currentIndex+1]===r&&(n="forward")}else n="forward";"forward"!==n&&"back"!==n&&(n="forward"),t._setaria_direction=n}},W._setaria_update_route_history=function(t,e){var r=e.current,n=e.next,i=t._setaria_direction,o=t._setaria_routeHistory;if("back"===i)0===o.currentIndex?o.currentIndex=null:(o.history[o.currentIndex]=r,o.currentIndex-=1);else if("forward"===i){if(null===o.currentIndex)o.currentIndex=0;else{if(o.currentIndex<o.history.length-1){var a=o.history.splice(0,o.currentIndex+1);o.history=a}o.currentIndex+=1}o.history.push(n)}};var X,Q,Z={state:J,getters:z,actions:K,mutations:W},tt={modules:(X={},X["_setaria_.common"]=Z,X),strict:!1},et={GET:"get",POST:"post",PUT:"put",DELETE:"delete",OPTIONS:"options",PATCH:"patch"},rt=function(){};rt.get=function(t,e,r){return h(et.GET,t,e,r)},rt.post=function(t,e,r){return h(et.POST,t,e,r)},rt.put=function(t,e,r){return h(et.PUT,t,e,r)},rt.delete=function(t,e,r){return h(et.DELETE,t,e,r)},rt.options=function(t,e,r){return h(et.OPTIONS,t,e,r)},rt.patch=function(t,e,r){return h(et.PATCH,t,e,r)},rt.all=function(t){return g(t)},rt.spread=function(t){return i.spread(t)};var nt="__Setaria_Storage_",it={LOCAL:"local",SESSION:"session"},ot=function(){};ot.setLocalItem=function(t,e){T(it.LOCAL,t,e)},ot.getLocalItem=function(t){return w(it.LOCAL,t)},ot.removeLocalItem=function(t){S(it.LOCAL,t)},ot.clearLocal=function(){b(it.LOCAL)},ot.setSessionItem=function(t,e){T(it.SESSION,t,e)},ot.getSessionItem=function(t){return w(it.SESSION,t)},ot.removeSessionItem=function(t){S(it.SESSION,t)},ot.clearSession=function(){b(it.SESSION)},t.use(a);var at=function(t){return null!==Q&&void 0!==Q||(Q=new t(tt)),Q}(a.Store),ut=function(t,e,r){var n=t.params,i=e.fullPath,o=at.state[B.GET_DIRECTION],a=t.fullPath;n&&"forward"===n.$$direction&&(o="forward",at.commit(B.SET_DIRECTION,o)),at.commit(B.UPDATE_DIRECTION,{current:i,next:a}),r()},st=function(t,e,r){var n=e.fullPath,i=t.fullPath;at.commit(B.UPDATE_ROUTE_HISTORY,{current:n,next:i}),r()},ct=function(t){function e(e){var r=this;void 0===e&&(e={}),t.call(this,e);var n=this;this.beforeEach(ut),this.beforeEach(st);var i=[];if("string"==typeof e.middleware){var o=N(e.middleware);"function"==typeof o&&i.push(o)}else R.isArray(e.middleware)&&e.middleware.forEach(function(t){var e=N(t);"function"==typeof e&&i.push(e)});i.forEach(function(t){r.beforeEach(function(e,r,i){var o=t({path:e.path,query:e.query,params:e.params,name:e.name,from:r,to:e,route:n});o instanceof Promise?o.then(function(t){x(i,t)}).catch(function(t){x(i,t)}):x(i,o)})});var a=M(e.routes);R.isEmpty(a)||a.forEach(function(t){var e=N(t.middleware);R.isFunction(e)&&r.beforeEach(function(r,i,o){if(D(r,t)){var a=e({path:r.path,query:r.query,params:r.params,name:r.name,from:i,to:r,route:n});a instanceof Promise?a.then(function(t){x(o,t)}).catch(function(t){x(o,t)}):x(o,a)}else o()})}),this.afterEach(function(){at.commit(B.SET_DIRECTION,"")})}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.forwardTo=function(t,e,r){void 0===e&&(e={}),void 0===r&&(r={}),at.commit(B.SET_DIRECTION,"forward"),R.isObject(t)?this.push(t):this.push({name:t,params:e,query:r})},e.prototype.backTo=function(){t.prototype.back.call(this)},e.prototype.back=function(){at.commit(B.SET_DIRECTION,"back"),t.prototype.back.call(this)},e.prototype.forward=function(){at.commit(B.SET_DIRECTION,"forward"),t.prototype.forward.call(this)},e}(o);ct.install=A,"undefined"!=typeof window&&t.use(ct),R.isProdunctionEnv()&&(t.config.silent=!0,t.config.productionTip=!1);var ft=new ct(k.router);return V.catchError(),{install:u,config:k,plugin:{router:ft,store:at},version:"0.2.0",ApplicationError:F,ServiceError:$,Http:rt,Message:q,Storage:ot,storeTypes:B,util:R}});