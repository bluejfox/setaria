/**
 * Setaria v0.0.5
 * (c) 2017 Ray Han
 * @license MIT
 */
!function(t,n){"object"==typeof exports&&"undefined"!=typeof module?module.exports=n(require("vue"),require("lodash"),require("moment"),require("moment/locale/zh-cn"),require("axios"),require("vue-router"),require("vuex")):"function"==typeof define&&define.amd?define(["vue","lodash","moment","moment/locale/zh-cn","axios","vue-router","vuex"],n):t.Setaria=n(t.Vue,t._,t.moment,null,t.axios,t.VueRouter,t.Vuex)}(this,function(t,n,e,r,o,i,u){"use strict";function c(t){}function a(){return x.message?x.message:{}}function s(){return Object.assign({},b,a())}function f(t){return s()[t]}function l(t,n){void 0===t&&(t=""),void 0===n&&(n=[]);var e=f(t),r=null===e||void 0===e?"":e;return A.isEmpty(r)||A.isEmpty(n)||n.forEach(function(t,n){var e="{"+n+"}";if(-1!==r.indexOf(e)){var o="number"==typeof t?t.toString():t;r=r.split(e).join(o)}}),r}function d(t){var n="";switch(t.charAt(t.length-1)){case"E":n="error";break;case"W":n="warning";break;case"I":default:n="info"}return n}function m(t){var n=!1;return t instanceof Object&&null!==t&&void 0!==t&&null!==t.id&&void 0!==t.id?n=!0:"string"==typeof t&&(n=-1!==t.indexOf(P)),n}function p(t){t=t.replace("Uncaught Error: ","");var n=t.split(N),e=n[0].replace(P,"").replace("[","").replace("]",""),r=n[1];return new D(e,[],r)}function v(t){var n=new D("MAM001E");if(null!==t&&void 0!==t){var e=null;switch(t){case 404:e="404";break;default:e="001"}n=new D("MAM"+e+"E")}return n}function h(t,n,e,r){return void 0===r&&(r={}),new Promise(function(i,u){var c=null,a=r;t===H.GET||t===H.DELETE||t===H.OPTIONS?(a.params=e,c=o[t](n,a)):c=o[t](n,e,a),c.then(function(t){i(t)}).catch(function(t){var n=new D("MAM001E");if(null!==t.response&&void 0!==t.response&&"number"==typeof t.response.status&&(n=v(t.response.status)),0===t.message.indexOf("timeout of")){var e=t.config.timeout;n=void 0===e||null===e?new D("MAM007E"):new D("MAM003E",[e])}u(n)})})}function E(t){return t===C.LOCAL?window.localStorage:window.sessionStorage}function g(t,n){E(t).setItem(j,JSON.stringify(n))}function y(t){var n=E(t);return null===n.getItem(j)&&n.setItem(j,JSON.stringify({})),JSON.parse(n.getItem(j))}function w(t,n,e){var r=y(t);r[n]=e,g(t,r)}function S(t,n){return y(t)[n]}function M(t,n){var e=y(t);delete e[n],g(t,e)}function I(t){g(t,{})}function O(t){O.installed||(O.installed=!0,i.install(t),t.mixin({destroyed:function(){this.$store.commit("common/direction","")}}))}t="default"in t?t.default:t,n="default"in n?n.default:n,e="default"in e?e.default:e,o="default"in o?o.default:o,i="default"in i?i.default:i,u="default"in u?u.default:u;var x={message:null,errorHanlder:null},A=function(){};A.isProdunctionEnv=function(){return!0},A.getNow=function(t){return void 0===t&&(t="LL"),e().format(t)},A.formatDate=function(t,n){void 0===n&&(n="YYYY-MM-DD");var r="";return e(t).isValid()&&void 0!==t&&(r=e(t).format(n)),r},A.toDate=function(t){var n=t;return A.isEmpty(t)||(n=e(t).toDate()),n},A.addDateTime=function(t,n,r){return e(t).add(n,r)},A.subtractDateTime=function(t,n,r){return e(t).subtract(n,r)},A.isEmpty=function(t){return n.isEmpty(t)},A.isEqual=function(t,e){return n.isEqual(t,e)},A.isNumber=function(t){return n.isNumber(t)},A.isString=function(t){return n.isString(t)},A.isDate=function(t){return n.isDate(t)},A.isArray=function(t){return n.isArray(t)},A.isObject=function(t){return n.isObject(t)},A.isFunction=function(t){return n.isFunction(t)},A.get=function(t,e,r){return void 0===r&&(r=null),n.get(t,e,r)},A.cloneDeep=function(t){return n.cloneDeep(t)},A.getUrlParameter=function(t){var n=window.location.search.substring(1),e=n.split("&"),r=e.find(function(n){return n.split("=")[0]===t});return r=null===r||void 0===r?"":r.split("=")[1]};var b={MAM001E:"\u8c03\u7528\u8fdc\u7a0b\u670d\u52a1\u7684\u8fc7\u7a0b\u4e2d\u51fa\u73b0\u672a\u77e5\u9519\u8bef\uff0c\u8bf7\u91cd\u8bd5\u6216\u8054\u7cfb\u7ba1\u7406\u5458\u3002",MAM002E:"\u7531\u4e8e\u60a8\u957f\u65f6\u95f4\u672a\u64cd\u4f5c\uff0c\u767b\u5f55\u72b6\u6001\u5df2\u8fc7\u671f\uff0c\u8bf7\u91cd\u65b0\u767b\u5f55\u3002",MAM003E:"\u670d\u52a1\u672a\u5728\u9884\u5b9a\u65f6\u95f4\uff08{0}\u79d2\uff09\u5185\u8fd4\u56de\u7ed3\u679c\uff0c\u8bf7\u8054\u7cfb\u7ba1\u7406\u5458\u6216\u7a0d\u540e\u91cd\u8bd5\u3002",MAM004E:"\u5ba2\u6237\u7aef\u51fa\u73b0\u9519\u8bef\uff0c\u8bf7\u91cd\u8bd5\u6216\u8054\u7cfb\u7ba1\u7406\u5458\u3002",MAM005E:"\u8ba4\u8bc1\u8fc7\u671f\u6216\u65e0\u6743\u8bbf\u95ee\u6b64\u670d\u52a1\uff0c\u8bf7\u70b9\u51fb\u6ce8\u9500\u6309\u94ae\u91cd\u65b0\u767b\u5f55\u3002",MAM006E:"\u65e0\u6cd5\u627e\u5230\u6307\u5b9a\u7684\u753b\u9762\u3002",MAM007E:"\u8bf7\u6c42\u7684\u670d\u52a1\u8bbf\u95ee\u8d85\u65f6\uff0c\u8bf7\u8054\u7cfb\u7ba1\u7406\u5458\u6216\u7a0d\u540e\u91cd\u8bd5\u3002",MAM008E:"\u65e0\u6cd5\u627e\u5230\u6307\u5b9a\u7684{0}\u5b9a\u4e49\u6587\u4ef6\u3002",MAM404E:"\u8bf7\u6c42\u7684\u670d\u52a1\u4e0d\u5b58\u5728\u3002"},L={SUCCESS:"success",WARNING:"warning",INFO:"info",ERROR:"error"},T=function(t,n,e){void 0===t&&(t=""),void 0===n&&(n=[]),void 0===e&&(e=""),this.id=t,this.type=d(t),this.params=n,this.message=l(this.id,this.params),A.isEmpty(this.message)&&!A.isEmpty(e)&&(this.message=e)};T.prototype.getMessage=function(){return this.message},T.prototype.toString=function(){return this.message};var P="Setaria Error",N=":",D=function(t){function n(n,e,r){void 0===n&&(n=""),void 0===e&&(e=[]),void 0===r&&(r="");var o=r;A.isEmpty(n)&&(n="unknown"),A.isEmpty(r)&&(o=new T(n,e,r).getMessage());var i=P+"["+n+"]"+N+o;t.call(this,i),this.id=n,this.params=e,this.type=L.ERROR,this.fullMessage=i,this.message=o}return t&&(n.__proto__=t),n.prototype=Object.create(t&&t.prototype),n.prototype.constructor=n,n}(Error),k=function(){};k.catchError=function(){t.config.errorHandler=function(t,n){k.handleError(t,n)},window.onerror=function(t){k.handleError(t)},window.onunhandledrejection=function(t){k.handleError(t)}},k.handleError=function(t,n){var e=this.parseError(t,n);"function"==typeof x.errorHanlder&&x.errorHanlder(e,t)},k.parseError=function(t,n){var e=null,r=n instanceof Object;if(m(t))e="string"==typeof t?p(t):t;else if(t instanceof PromiseRejectionEvent){var o=t.reason,i=o.id,u=o.params;void 0===u&&(u=[]),e=null!==i&&void 0!==i?new D(i,u):new D("MAM004E")}else if(r||t instanceof Error)if(A.isProdunctionEnv())e=new D("MAM004E");else{var c=t.message;e=new D("",[],c)}else e="string"==typeof t?0===t.indexOf("Uncaught Error: ")?new D("",[],t.replace("Uncaught Error: ","")):new D("",[],t):new D("MAM004E");return r&&console.error(t),e};var H={GET:"get",POST:"post",PUT:"put",DELETE:"delete",OPTIONS:"options",PATCH:"patch"},_=function(){};_.get=function(t,n,e){return h(H.GET,t,n,e)},_.post=function(t,n,e){return h(H.POST,t,n,e)},_.put=function(t,n,e){return h(H.PUT,t,n,e)},_.delete=function(t,n,e){return h(H.DELETE,t,n,e)},_.options=function(t,n,e){return h(H.OPTIONS,t,n,e)},_.patch=function(t,n,e){return h(H.PATCH,t,n,e)};var j="__Setaria_Storage_",C={LOCAL:"local",SESSION:"session"},q=function(){};q.setLocalItem=function(t,n){w(C.LOCAL,t,n)},q.getLocalItem=function(t){return S(C.LOCAL,t)},q.removeLocalItem=function(t){M(C.LOCAL,t)},q.clearLocal=function(){I(C.LOCAL)},q.setSessionItem=function(t,n){w(C.SESSION,t,n)},q.getSessionItem=function(t){return S(C.SESSION,t)},q.removeSessionItem=function(t){M(C.SESSION,t)},q.clearSession=function(){I(C.SESSION)};var R,U={direction:"",loading:!1,routeHistory:{currentIndex:null,history:[]},token:"",user:null},V={routeHistory:function(t){return t.routeHistory},routeCurrentIndex:function(t){return t.routeHistory.currentIndex}},G={},Y={direction:function(t,n){t.direction=n},loading:function(t,n){t.loading=n},token:function(t,n){t.token=n},user:function(t,n){t.user=n},updateDirection:function(t,n){var e=(n.current,n.next),r=t.direction;console.log("updateDirection",r);var o=t.routeHistory;if("forward"!==r&&"back"!==r){if(o.history.length>0)if(o.currentIndex===o.history.length-1)r="back";else{0!==o.currentIndex&&o.history[o.currentIndex]===e&&(r="back"),""===r&&o.history[o.currentIndex+1]===e&&(r="forward")}else r="forward";"forward"!==r&&"back"!==r&&(r="forward"),t.direction=r}console.log(t.direction)},updateHistory:function(t,n){var e=n.current,r=n.next,o=t.direction,i=t.routeHistory;if("back"===o)0===i.currentIndex?i.currentIndex=null:(i.history[i.currentIndex]=e,i.currentIndex-=1);else if("forward"===o){if(null===i.currentIndex)i.currentIndex=0;else{if(i.currentIndex<i.history.length-1){var u=i.history.splice(0,i.currentIndex+1);i.history=u}i.currentIndex+=1}i.history.push(r)}}},F={namespaced:!0,state:U,getters:V,actions:G,mutations:Y},J={modules:{common:F},strict:!1};t.use(u);var $=function(t){return R=new t(J)}(u.Store),z=function(t,n,e){var r=t.params,o=n.fullPath,i=$.state.common.direction,u=t.fullPath;r&&"forward"===r.$$direction&&(i="forward",$.commit("common/direction",i)),$.commit("common/updateDirection",{current:o,next:u}),e()},W=function(t,n,e){var r=n.fullPath,o=t.fullPath;$.commit("common/updateHistory",{current:r,next:o}),e()},B=function(t){function n(n){void 0===n&&(n={}),t.call(this,n),this.beforeEach(z),this.beforeEach(W)}return t&&(n.__proto__=t),n.prototype=Object.create(t&&t.prototype),n.prototype.constructor=n,n.prototype.forwardTo=function(t,n,e){void 0===n&&(n={}),void 0===e&&(e={}),$.commit("common/direction","forward"),this.push({name:t,params:n,query:e})},n.prototype.push=function(n,e,r){$.commit("common/direction","forward"),t.prototype.push.call(this,n,e,r)},n.prototype.forward=function(){$.commit("common/direction","forward"),t.prototype.forward.call(this)},n.prototype.backTo=function(){$.commit("common/direction","back"),t.prototype.back.call(this)},n}(i);return B.install=O,"undefined"!=typeof window&&window.Vue&&window.Vue.use(B),A.isProdunctionEnv()&&(t.config.silent=!0,t.config.productionTip=!1),k.catchError(),{install:c,config:x,plugin:{Navigate:B,store:$},version:"0.0.5",ApplicationError:D,Http:_,Message:T,Storage:q,util:A}});