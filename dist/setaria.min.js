/**
 * Setaria v0.1.0
 * (c) 2018 Ray Han
 * @license MIT
 */
!function(n,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("vue"),require("lodash"),require("moment"),require("moment/locale/zh-cn"),require("axios"),require("vue-router"),require("vuex")):"function"==typeof define&&define.amd?define(["vue","lodash","moment","moment/locale/zh-cn","axios","vue-router","vuex"],t):n.Setaria=t(n.Vue,n._,n.moment,null,n.axios,n.VueRouter,n.Vuex)}(this,function(n,t,e,r,o,i,u){"use strict";function c(n){}function a(){return L.message?L.message:{}}function s(){return Object.assign({},T,a())}function f(n){return s()[n]}function d(n,t){void 0===n&&(n=""),void 0===t&&(t=[]);var e=f(n),r=null===e||void 0===e?"":e;return P.isEmpty(r)||P.isEmpty(t)||t.forEach(function(n,t){var e="{"+t+"}";if(-1!==r.indexOf(e)){var o="number"==typeof n?n.toString():n;r=r.split(e).join(o)}}),r}function l(n){var t="";switch(n.charAt(n.length-1)){case"E":t="error";break;case"W":t="warning";break;case"I":default:t="info"}return t}function p(n){var t=document.createEvent("Event");t.initEvent("unhandledrejection",!1,!0);var e={reason:{value:n,writable:!1}};Object.defineProperties(t,e),window.dispatchEvent(t)}function m(n){var t=!1;return n instanceof Object&&null!==n&&void 0!==n&&null!==n.id&&void 0!==n.id?t=!0:"string"==typeof n&&(t=-1!==n.indexOf(C)),t}function v(n){var t="",e="";if("string"==typeof n){0===n.indexOf("Error: ")?n=n.replace("Error: ",""):0===n.indexOf("Uncaught Error: ")&&(n=n.replace("Uncaught Error: ",""));var r=n.split(_);return t=r[0].replace(C,"").replace("[","").replace("]",""),e=r[1],new D(t,[],e)}return new D(n.id,[],n.noIdMessage)}function h(){return q}function E(n,t){var e=new j("MAM001E",t);if(null!==n&&void 0!==n){var r=null;switch(n){case 404:r="404";break;default:r="001"}e=new j("MAM"+r+"E",t)}return e}function g(n,t,e,r){return void 0===r&&(r={}),new Promise(function(i,u){var c=null,a=r;n===$.GET||n===$.DELETE||n===$.OPTIONS?(a.params=e,c=o[n](t,a)):c=o[n](t,e,a);var s=h();!1!==r.loading&&null!==s&&void 0!==s&&s.commit("common/addLoadingCount"),c.then(function(n){!1!==r.loading&&null!==s&&void 0!==s&&s.commit("common/subLoadingCount"),i(n)}).catch(function(n){!1!==r.loading&&null!==s&&void 0!==s&&s.commit("common/subLoadingCount");var t=new j("MAM001E",n);if(null!==n.response&&void 0!==n.response&&"number"==typeof n.response.status&&(t=E(n.response.status,n)),0===n.message.indexOf("timeout of")){var e=n.config.timeout;t=void 0===e||null===e?new j("MAM007E",n):new j("MAM003E",n,[e])}u(t)})})}function y(n){return new Promise(function(t,e){o.all(n).then(function(n){t(n)})})}function w(n){return n===W.LOCAL?window.localStorage:window.sessionStorage}function S(n,t){w(n).setItem(z,JSON.stringify(t))}function M(n){var t=w(n);return null===t.getItem(z)&&t.setItem(z,JSON.stringify({})),JSON.parse(t.getItem(z))}function I(n,t,e){var r=M(n);r[t]=e,S(n,r)}function O(n,t){return M(n)[t]}function x(n,t){var e=M(n);delete e[t],S(n,e)}function b(n){S(n,{})}function A(n){A.installed||(A.installed=!0,i.install(n),n.mixin({mounted:function(){this.$store&&this.$store.commit("common/direction","")}}))}n="default"in n?n.default:n,t="default"in t?t.default:t,e="default"in e?e.default:e,o="default"in o?o.default:o,i="default"in i?i.default:i,u="default"in u?u.default:u;var L={message:null,errorHanlder:null},P=function(){};P.isProdunctionEnv=function(){return!0},P.isFirefox=function(){var n=window.navigator.userAgent.toLowerCase();return"undefined"!=typeof window&&n&&/firefox\/\d+/.test(n)},P.getNow=function(n){return void 0===n&&(n="LL"),e().format(n)},P.formatDate=function(n,t){void 0===t&&(t="YYYY-MM-DD");var r="";return e(n).isValid()&&void 0!==n&&(r=e(n).format(t)),r},P.toDate=function(n){var t=n;return P.isEmpty(n)||(t=e(n).toDate()),t},P.addDateTime=function(n,t,r){return e(n).add(t,r)},P.subtractDateTime=function(n,t,r){return e(n).subtract(t,r)},P.isEmpty=function(n){return t.isEmpty(n)},P.isEqual=function(n,e){return t.isEqual(n,e)},P.isNumber=function(n){return t.isNumber(n)},P.isString=function(n){return t.isString(n)},P.isDate=function(n){return t.isDate(n)},P.isArray=function(n){return t.isArray(n)},P.isObject=function(n){return t.isObject(n)},P.isFunction=function(n){return t.isFunction(n)},P.get=function(n,e,r){return void 0===r&&(r=null),t.get(n,e,r)},P.cloneDeep=function(n){return t.cloneDeep(n)},P.getUrlParameter=function(n){var t=window.location.search.substring(1),e=t.split("&"),r=e.find(function(t){return t.split("=")[0]===n});return r=null===r||void 0===r?"":r.split("=")[1]};var T={MAM001E:"\u8c03\u7528\u8fdc\u7a0b\u670d\u52a1\u7684\u8fc7\u7a0b\u4e2d\u51fa\u73b0\u672a\u77e5\u9519\u8bef\uff0c\u8bf7\u91cd\u8bd5\u6216\u8054\u7cfb\u7ba1\u7406\u5458\u3002",MAM002E:"\u7531\u4e8e\u60a8\u957f\u65f6\u95f4\u672a\u64cd\u4f5c\uff0c\u767b\u5f55\u72b6\u6001\u5df2\u8fc7\u671f\uff0c\u8bf7\u91cd\u65b0\u767b\u5f55\u3002",MAM003E:"\u670d\u52a1\u672a\u5728\u9884\u5b9a\u65f6\u95f4\uff08{0}\u79d2\uff09\u5185\u8fd4\u56de\u7ed3\u679c\uff0c\u8bf7\u8054\u7cfb\u7ba1\u7406\u5458\u6216\u7a0d\u540e\u91cd\u8bd5\u3002",MAM004E:"\u5ba2\u6237\u7aef\u51fa\u73b0\u9519\u8bef\uff0c\u8bf7\u91cd\u8bd5\u6216\u8054\u7cfb\u7ba1\u7406\u5458\u3002",MAM005E:"\u8ba4\u8bc1\u8fc7\u671f\u6216\u65e0\u6743\u8bbf\u95ee\u6b64\u670d\u52a1\uff0c\u8bf7\u70b9\u51fb\u6ce8\u9500\u6309\u94ae\u91cd\u65b0\u767b\u5f55\u3002",MAM006E:"\u65e0\u6cd5\u627e\u5230\u6307\u5b9a\u7684\u753b\u9762\u3002",MAM007E:"\u8bf7\u6c42\u7684\u670d\u52a1\u8bbf\u95ee\u8d85\u65f6\uff0c\u8bf7\u8054\u7cfb\u7ba1\u7406\u5458\u6216\u7a0d\u540e\u91cd\u8bd5\u3002",MAM008E:"\u65e0\u6cd5\u627e\u5230\u6307\u5b9a\u7684{0}\u5b9a\u4e49\u6587\u4ef6\u3002",MAM404E:"\u8bf7\u6c42\u7684\u670d\u52a1\u4e0d\u5b58\u5728\u3002"},N={SUCCESS:"success",WARNING:"warning",INFO:"info",ERROR:"error"},k=function(n,t,e){void 0===n&&(n=""),void 0===t&&(t=[]),void 0===e&&(e=""),this.id=n,this.type=l(n),this.params=t,this.message=d(this.id,this.params),P.isEmpty(this.message)&&!P.isEmpty(e)&&(this.message=e)};k.prototype.getMessage=function(){return this.message},k.prototype.toString=function(){return this.message};var C="Setaria Error",_=":",D=function(n){function t(t,e,r){void 0===t&&(t=""),void 0===e&&(e=[]),void 0===r&&(r="");var o=r;P.isEmpty(t)&&(t="unknown"),P.isEmpty(r)&&(o=new k(t,e,r).getMessage());var i=C+"["+t+"]"+_+o;n.call(this,i),this.id=t,this.params=e,this.type=N.ERROR,this.noIdMessage=o,this.message=i}return n&&(t.__proto__=n),t.prototype=Object.create(n&&n.prototype),t.prototype.constructor=t,t}(Error),j=function(n){function t(t,e,r,o){void 0===t&&(t=""),void 0===e&&(e={}),void 0===r&&(r=[]),void 0===o&&(o=""),n.call(this,t,r,o),this.type="ServiceError",this.detail=e,P.isFirefox()&&!1!==P.get(e,"config.isShowError",!0)&&p(this)}return n&&(t.__proto__=n),t.prototype=Object.create(n&&n.prototype),t.prototype.constructor=t,t}(D),H=function(){};H.catchError=function(){n.config.errorHandler=function(n,t){H.handleError(n,t)},window.onerror=function(n){H.handleError(n)},window.addEventListener("unhandledrejection",function(n){H.handleError(n)})},H.handleError=function(n,t){var e=this.parseError(n,t);"function"==typeof L.errorHanlder&&L.errorHanlder(e,n)},H.parseError=function(n,t){var e=null,r=t instanceof Object;if(m(n))e=v(n);else if("unhandledrejection"===n.type&&"object"==typeof n){var o=n.reason,i=o.id,u=o.message,c=o.noIdMessage,a=o.detail;e="ServiceError"===n.reason.type?n.reason:null!==c&&void 0!==c?new j(i,a,[],c):null!==u&&void 0!==u?new j("",a,[],u):new j("MAM004E",a)}else if(r&&n instanceof Error)if(P.isProdunctionEnv())e=new D("MAM004E");else{var s=n.message;e=new D("",[],s)}else e="string"==typeof n?0===n.indexOf("Uncaught Error: ")?new D("",[],n.replace("Uncaught Error: ","")):new D("",[],n):new D("MAM004E");return r&&console.error(n),e};var q,R={direction:"",loading:0,routeHistory:{currentIndex:null,history:[]},token:"",user:null},U={routeHistory:function(n){return n.routeHistory},routeCurrentIndex:function(n){return n.routeHistory.currentIndex},isLoading:function(n){return 0!==n.loading}},V={},F={direction:function(n,t){n.direction=t},addLoadingCount:function(n){n.loading++},subLoadingCount:function(n){var t=n;t.loading>0&&t.loading--},token:function(n,t){n.token=t},user:function(n,t){n.user=t},updateDirection:function(n,t){var e=(t.current,t.next),r=n.direction,o=n.routeHistory;if("forward"!==r&&"back"!==r){if(o.history.length>0)if(o.currentIndex===o.history.length-1)r="back";else{0!==o.currentIndex&&o.history[o.currentIndex-1]===e&&(r="back"),""===r&&o.history[o.currentIndex+1]===e&&(r="forward")}else r="forward";"forward"!==r&&"back"!==r&&(r="forward"),n.direction=r}},updateHistory:function(n,t){var e=t.current,r=t.next,o=n.direction,i=n.routeHistory;if("back"===o)0===i.currentIndex?i.currentIndex=null:(i.history[i.currentIndex]=e,i.currentIndex-=1);else if("forward"===o){if(null===i.currentIndex)i.currentIndex=0;else{if(i.currentIndex<i.history.length-1){var u=i.history.splice(0,i.currentIndex+1);i.history=u}i.currentIndex+=1}i.history.push(r)}}},G={namespaced:!0,state:R,getters:U,actions:V,mutations:F},Y={modules:{common:G},strict:!1},$={GET:"get",POST:"post",PUT:"put",DELETE:"delete",OPTIONS:"options",PATCH:"patch"},J=function(){};J.get=function(n,t,e){return g($.GET,n,t,e)},J.post=function(n,t,e){return g($.POST,n,t,e)},J.put=function(n,t,e){return g($.PUT,n,t,e)},J.delete=function(n,t,e){return g($.DELETE,n,t,e)},J.options=function(n,t,e){return g($.OPTIONS,n,t,e)},J.patch=function(n,t,e){return g($.PATCH,n,t,e)},J.all=function(n){return y(n)},J.spread=function(n){return o.spread(n)};var z="__Setaria_Storage_",W={LOCAL:"local",SESSION:"session"},B=function(){};B.setLocalItem=function(n,t){I(W.LOCAL,n,t)},B.getLocalItem=function(n){return O(W.LOCAL,n)},B.removeLocalItem=function(n){x(W.LOCAL,n)},B.clearLocal=function(){b(W.LOCAL)},B.setSessionItem=function(n,t){I(W.SESSION,n,t)},B.getSessionItem=function(n){return O(W.SESSION,n)},B.removeSessionItem=function(n){x(W.SESSION,n)},B.clearSession=function(){b(W.SESSION)},n.use(u);var K=function(n){return q=new n(Y)}(u.Store),Q=function(n,t,e){var r=n.params,o=t.fullPath,i=K.state.common.direction,u=n.fullPath;r&&"forward"===r.$$direction&&(i="forward",K.commit("common/direction",i)),K.commit("common/updateDirection",{current:o,next:u}),e()},X=function(n,t,e){var r=t.fullPath,o=n.fullPath;K.commit("common/updateHistory",{current:r,next:o}),e()},Z=function(n){function t(t){void 0===t&&(t={}),n.call(this,t),this.beforeEach(Q),this.beforeEach(X)}return n&&(t.__proto__=n),t.prototype=Object.create(n&&n.prototype),t.prototype.constructor=t,t.prototype.forwardTo=function(n,t,e){void 0===t&&(t={}),void 0===e&&(e={}),K.commit("common/direction","forward"),this.push({name:n,params:t,query:e})},t.prototype.backTo=function(){n.prototype.back.call(this)},t.prototype.back=function(){K.commit("common/direction","back"),n.prototype.back.call(this)},t.prototype.forward=function(){K.commit("common/direction","forward"),n.prototype.forward.call(this)},t}(i);return Z.install=A,"undefined"!=typeof window&&window.Vue&&window.Vue.use(Z),P.isProdunctionEnv()&&(n.config.silent=!0,n.config.productionTip=!1),H.catchError(),{install:c,config:L,plugin:{Navigate:Z,store:K},version:"0.1.0",ApplicationError:D,ServiceError:j,Http:J,Message:k,Storage:B,util:P}});